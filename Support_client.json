{
  "name": "Support_client",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "messages"
        ]
      },
      "type": "n8n-nodes-base.whatsAppTrigger",
      "typeVersion": 1,
      "position": [
        0,
        0
      ],
      "id": "dfa9ebce-1198-4cec-9304-809429d46324",
      "name": "WhatsApp Trigger",
      "webhookId": "8a102c3d-9486-47d8-8961-bc86994270ab"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "5",
        "contextWindowLength": 50
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        160,
        220
      ],
      "id": "a0161e5f-33a8-4448-afa9-3da1fc583709",
      "name": "Window Buffer Memory"
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "518211531376052",
        "recipientPhoneNumber": "={{ $('WhatsApp Trigger').item.json.contacts[0].wa_id }}\n\n",
        "textBody": "={{ $json.output }}",
        "additionalFields": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        900,
        0
      ],
      "id": "3a2d87b8-69ea-4c34-bb05-a595c314bbec",
      "name": "WhatsApp Business Cloud",
      "webhookId": "eb8a82e9-ebd4-4dee-9ad2-64c6b274547c"
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "jimmygay13180@gmail.com",
          "mode": "list",
          "cachedResultName": "jimmygay13180@gmail.com"
        },
        "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}",
        "end": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}",
        "useDefaultReminders": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Use_Default_Reminders', ``, 'boolean') }}",
        "additionalFields": {
          "conferenceDataUi": {
            "conferenceDataValues": {
              "conferenceSolution": "hangoutsMeet"
            }
          },
          "description": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', ``, 'string') }}"
        }
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        280,
        220
      ],
      "id": "e5ad0108-35fb-4564-98a2-aa3a70b882b4",
      "name": "create_event"
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "jimmygay13180@gmail.com",
          "mode": "list",
          "cachedResultName": "jimmygay13180@gmail.com"
        },
        "returnAll": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}",
        "timeMin": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('After', ``, 'string') }}",
        "timeMax": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Before', ``, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        400,
        220
      ],
      "id": "df314b17-52a9-4950-b4ba-afff947eb8b3",
      "name": "get_event"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        40,
        220
      ],
      "id": "c4b4aac0-8ee6-4aed-aa33-1ed292c341dc",
      "name": "OpenAI Chat Model"
    },
    {
      "parameters": {
        "sendTo": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('To', ``, 'string') }}",
        "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}",
        "message": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', `Mail d'invitation au rendez-vous google meet.`, 'string') }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmailTool",
      "typeVersion": 2.1,
      "position": [
        520,
        220
      ],
      "id": "c9b0a401-239a-47fc-bd62-d3e0541b2690",
      "name": "invitation_mail",
      "webhookId": "9a15fb3c-2167-4cb3-8097-98291fb12a3b"
    },
    {
      "parameters": {
        "outputFieldName": "={{$now}}\n// n8n displays the ISO formatted timestamp\n// For example 2022-03-09T14:02:37.065+00:00\n{{\"Today's date is \" + $now}}\n// n8n displays \"Today's date is <unix timestamp>\"\n// For example \"Today's date is 1646834498755\"",
        "options": {
          "timezone": "Europe/Paris"
        }
      },
      "type": "n8n-nodes-base.dateTimeTool",
      "typeVersion": 2,
      "position": [
        640,
        220
      ],
      "id": "d4845aa7-7899-44dc-87f4-420007b1de74",
      "name": "Date_and_Time"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1juclaa-4Q4Exz57A-nsRWqBVHsr2maPzZ1ptS5889s8",
          "mode": "list",
          "cachedResultName": "nana-ai",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1juclaa-4Q4Exz57A-nsRWqBVHsr2maPzZ1ptS5889s8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Feuille 1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1juclaa-4Q4Exz57A-nsRWqBVHsr2maPzZ1ptS5889s8/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Nom et Pr√©nom": "={{ $('WhatsApp Trigger').item.json.contacts[0].profile.name }}",
            "Email": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Email', `Met √† jour la colonne \"Email\" quand l'interlocuteur te le donne dans la discussion whatsapp.`, 'string') }}",
            "T√©l√©phone": "={{ $('WhatsApp Trigger').item.json.contacts[0].wa_id }}",
            "service int√©ress√©": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('service_int_ress_', ``, 'string') }}",
            "Rendez-vous": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Rendez-vous', ``, 'string') }}"
          },
          "matchingColumns": [
            "Nom et Pr√©nom"
          ],
          "schema": [
            {
              "id": "Nom et Pr√©nom",
              "displayName": "Nom et Pr√©nom",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "T√©l√©phone",
              "displayName": "T√©l√©phone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "service int√©ress√©",
              "displayName": "service int√©ress√©",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Rendez-vous",
              "displayName": "Rendez-vous",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.5,
      "position": [
        760,
        220
      ],
      "id": "51aee69f-3347-492b-8d31-cb654732d080",
      "name": "google_sheets"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.tavily.com/search",
        "sendBody": true,
        "specifyBody": "={\n  \"api_key\":\"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\",\n\"query\":\"recherche sur le web si n√©cessaire\",\n\"search_depth\":\"basic\",\n\"include_answer\":\"true\",\n\"topic\":\"general\",\n\"include_raw_content\":true,\n\"max_results\":3\n}",
        "parametersBody": {
          "values": [
            {}
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
      "typeVersion": 1.1,
      "position": [
        880,
        220
      ],
      "id": "e5df84f8-8011-414a-92a5-0ac728205d40",
      "name": "tavily"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.messages[0].text.body }}\n\nexp√©diteur : {{ $json.contacts[0].profile.name }}\nnum√©ro : {{ $json.contacts[0].wa_id }}",
        "options": {
          "systemMessage": "=## Contexte\nTu es Gastro, l'assistant IA officiel de messagerie WhatsApp du restaurant \"La Table Gourmande\". La Table Gourmande est un restaurant sp√©cialis√© dans la cuisine traditionnelle fran√ßaise avec une touche moderne. L'√©tablissement est dirig√© par son Chef propri√©taire, Monsieur Thomas Durand. Tu repr√©sentes la marque et assures une exp√©rience client exceptionnelle en g√©rant les conversations de mani√®re professionnelle et naturelle.\n\n## Description du restaurant\n- La Table Gourmande propose une cuisine fran√ßaise traditionnelle revisit√©e avec des ingr√©dients locaux et de saison\n- Le restaurant dispose d'une salle principale de 50 couverts et d'une terrasse estivale de 30 places\n- L'√©tablissement offre un service midi et soir du mardi au samedi (ferm√© dimanche et lundi)\n- Monsieur Thomas Durand, Chef propri√©taire, dirige le restaurant avec passion et cr√©ativit√©\n- Tu es l'assistant officiel du restaurant, facilitant les r√©servations et informant les clients sur les services propos√©s\n\n## Objectifs\n1. Cr√©er des conversations fluides ressemblant √† de vrais √©changes WhatsApp\n2. Repr√©senter efficacement le restaurant et ses services\n3. R√©cup√©rer et enregistrer les donn√©es de contact dans Google Sheet:\n   - Nom et Pr√©nom : {{ $json.contacts[0].profile.name }}\n   - Num√©ro : {{ $json.contacts[0].wa_id }}\n\n## Utilisation syst√©matique des outils\n- Utilise TOUJOURS l'outil \"check_availability\" quand on te demande de v√©rifier des disponibilit√©s ou de r√©server une table\n- Utilise TOUJOURS l'outil \"create_reservation\" pour cr√©er une r√©servation apr√®s confirmation claire d'un cr√©neau\n- N'utilise JAMAIS les outils sans n√©cessit√© (pas de v√©rification de disponibilit√© pour des questions g√©n√©rales)\n- Lorsqu'un utilisateur demande une r√©servation, lance imm√©diatement la v√©rification avec \"check_availability\"\n- Apr√®s cr√©ation d'une r√©servation, confirme toujours l'action et le r√©sultat\n- N'imagine JAMAIS les r√©sultats des outils - utilise-les r√©ellement\n- Utilise ton outil \"tavily\" pour effectuer des recherches sur le web si n√©cessaire\n- Utilise ton outil \"send_confirmation\" pour envoyer le message de confirmation de r√©servation :\n      ### Structure du message :\nObjet : La Table Gourmande : Confirmation de votre r√©servation le [date de la r√©servation]\nContenu : [R√©dig√© par l'agent]\n\n### Outil check_availability\n- Fonction: v√©rifier les tables disponibles dans le syst√®me de r√©servation\n- Utilisation: d√®s qu'une demande de r√©servation est exprim√©e\n- Format: dates au format YYYY-MM-DD\n- Exemple: \"Je v√©rifie tout de suite les disponibilit√©s pour la date demand√©e\" suivi de l'utilisation effective de l'outil\n\n### Outil create_reservation\n- Fonction: cr√©er une r√©servation de table avec confirmation\n- Utilisation: uniquement apr√®s confirmation claire d'un cr√©neau\n- Param√®tres obligatoires:\n  * nom: nom du client\n  * nombre_personnes: nombre de convives\n  * date: YYYY-MM-DD\n  * heure: HH:MM\n  * contact: num√©ro de t√©l√©phone ou email\n  * demandes_sp√©ciales: allergies, occasion sp√©ciale, etc. (optionnel)\n- Exemple: \"Je cr√©e tout de suite votre r√©servation\" suivi de l'utilisation effective de l'outil\n\n## Pr√©sentation et identit√©\n- Lors de la premi√®re interaction, pr√©sente-toi: \"Bonjour ! Je suis Gastro, l'assistant virtuel de La Table Gourmande. Comment puis-je vous aider aujourd'hui ? üçΩÔ∏è\"\n- Assure-toi de mentionner que tu fais partie de l'√©quipe de La Table Gourmande d√®s le premier contact\n- Si pertinent, tu peux mentionner que Monsieur Thomas Durand est le Chef propri√©taire du restaurant\n- Adapte ta pr√©sentation selon le contexte (formel/informel)\n- Ne te pr√©sente qu'une seule fois par conversation\n\n## Ton et style\n- Conversationnel, chaleureux et professionnel\n- Langage simple avec phrases courtes typiques de WhatsApp\n- √âmojis pertinents li√©s √† la gastronomie pour humaniser sans exc√®s üçΩÔ∏è üç∑ ‚ú®\n- Contractions et expressions famili√®res professionnelles\n- Adaptation au niveau de langage de l'interlocuteur\n- √âviter absolument les formulations d'emails formels\n\n## Structure des messages\n- Une seule salutation par jour pour un m√™me interlocuteur\n- Messages courts et percutants (1-3 phrases maximum)\n- Fractionnement naturel des longues informations en plusieurs messages\n- Questions directes pour maintenir la conversation engageante\n- √âviter les listes √† puces et paragraphes formels\n\n## Connaissance du restaurant\n- Tu connais parfaitement la carte, les plats signature et les sp√©cialit√©s du Chef\n- Tu peux expliquer les diff√©rentes formules propos√©es (menu du jour, menu d√©gustation, carte)\n- Tu comprends les avantages du restaurant: qualit√© des produits, cuisine maison, ambiance chaleureuse\n- Tu peux donner des informations sur les allerg√®nes et options v√©g√©tariennes/v√©ganes\n\n## Gestion des r√©servations\n- V√©rification OBLIGATOIRE des disponibilit√©s avec \"check_availability\"\n- Proposition de cr√©neaux en langage conversationnel bas√©e sur les r√©sultats r√©els: \"Nous avons une table pour vendredi 20h ou samedi 19h30. Qu'est-ce qui vous conviendrait le mieux?\"\n- Cr√©ation OBLIGATOIRE de r√©servation avec \"create_reservation\" apr√®s confirmation claire\n- Jamais de double r√©servation ou envois multiples pour le m√™me cr√©neau\n- Collecte syst√©matique des informations n√©cessaires: \"Super pour vendredi 20h! Combien serez-vous? Avez-vous des demandes particuli√®res?\"\n- Confirmation simple apr√®s envoi: \"C'est fait! Votre table est r√©serv√©e pour vendredi 20h. Nous avons h√¢te de vous accueillir üë®‚Äçüç≥\"\n\n## Flux de conversation pour r√©servation\n1. Salutation personnalis√©e (unique)\n2. V√©rification IMM√âDIATE des disponibilit√©s avec check_availability (utilisation r√©elle)\n3. Proposition conversationnelle de cr√©neaux (2-3 maximum) bas√©e sur les r√©sultats\n4. Confirmation claire du cr√©neau choisi\n5. Demande d'informations compl√©mentaires (nombre de personnes, occasion sp√©ciale, allergies)\n6. Cr√©ation UNIQUE de la r√©servation avec create_reservation (utilisation r√©elle)\n7. Confirmation simple de la r√©servation\n8. Transition fluide vers la suite de la conversation (suggestions pour le repas, informations pratiques)\n\n## Gestion des demandes d'information\n- R√©ponses concises et informatives sur le menu, les horaires, les services et l'emplacement\n- Partage d'informations sur les √©v√©nements sp√©ciaux (soir√©es th√©matiques, d√©gustations)\n- Informations pr√©cises sur les allerg√®nes et r√©gimes alimentaires sp√©cifiques\n- Descriptions all√©chantes mais honn√™tes des plats signature\n- Explications sur les possibilit√©s de privatisation et √©v√©nements de groupe\n\n## S√©curit√© et √©thique\n- Protection absolue des informations confidentielles des clients\n- V√©rification d'identit√© pour modifications de r√©servations\n- Respect strict du RGPD et des normes de confidentialit√©\n- Transparence sur ton statut d'assistant IA\n- Pas de partage de donn√©es clients avec des tiers\n\n## R√©solution de probl√®mes\n- Approche proactive pour r√©soudre les difficult√©s des clients (modifications de r√©servation, demandes sp√©ciales)\n- Escalade appropri√©e vers l'√©quipe humaine quand n√©cessaire\n- Suivi personnalis√© jusqu'√† r√©solution compl√®te\n- R√©f√©rence √† Monsieur Thomas Durand pour les questions li√©es √† la cuisine ou demandes particuli√®res\n- Gestion courtoise des annulations et reports avec proposition d'alternatives"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        380,
        0
      ],
      "id": "47a6b081-d232-4405-b561-85d545370bef",
      "name": "Support_client"
    }
  ],
  "pinData": {},
  "connections": {
    "WhatsApp Trigger": {
      "main": [
        [
          {
            "node": "Support_client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "Support_client",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "create_event": {
      "ai_tool": [
        [
          {
            "node": "Support_client",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "get_event": {
      "ai_tool": [
        [
          {
            "node": "Support_client",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Support_client",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "invitation_mail": {
      "ai_tool": [
        [
          {
            "node": "Support_client",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Date_and_Time": {
      "ai_tool": [
        [
          {
            "node": "Support_client",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "google_sheets": {
      "ai_tool": [
        [
          {
            "node": "Support_client",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "tavily": {
      "ai_tool": [
        [
          {
            "node": "Support_client",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Support_client": {
      "main": [
        [
          {
            "node": "WhatsApp Business Cloud",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "f7a00208-8d58-4334-8713-f0fd6b70ffad",
  "meta": {
    "instanceId": "21b9420dd846f0fbd18362b61d7f712595fb4c489557710468d0c79403ebdf05"
  },
  "id": "OYnJqKIqRVXLLkMW",
  "tags": []
}